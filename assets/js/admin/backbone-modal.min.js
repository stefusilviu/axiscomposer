!function(a,b,c){"use strict";a.fn.ACBackboneModal=function(b){return this.each(function(){new a.ACBackboneModal(a(this),b)})},a.ACBackboneModal=function(b,c){var d=a.extend({},a.ACBackboneModal.defaultOptions,c);d.template&&new a.ACBackboneModal.View({target:d.template,string:d.variable})},a.ACBackboneModal.defaultOptions={template:"",variable:{}},a.ACBackboneModal.View=b.View.extend({tagName:"div",id:"ac-backbone-modal-dialog",_target:void 0,_string:void 0,events:{"click .modal-close":"closeButton","click #btn-ok":"addButton","touchstart #btn-ok":"addButton",keydown:"keyboardActions"},resizeContent:function(){var b=a(".ac-backbone-modal-content").find("article"),c=b.height()<90?90:b.height(),d=a(window).height()-200;d>400&&(d=400),c>d?b.css({overflow:"auto",height:d+"px"}):b.css({overflow:"visible",height:c>90?"auto":c+"px"}),a(".ac-backbone-modal-content").css({"margin-top":"-"+a(".ac-backbone-modal-content").height()/2+"px","margin-left":"-"+a(".ac-backbone-modal-content").width()/2+"px"})},initialize:function(b){var d=this;this._target=b.target,this._string=b.string,c.bindAll(this,"render"),this.render(),a(window).resize(function(){d.resizeContent()})},render:function(){var b=wp.template(this._target);this.$el.attr("tabindex","0").append(b(this._string)),a(document.body).css({overflow:"hidden"}).append(this.$el),this.resizeContent(),a(document.body).trigger("ac_backbone_modal_loaded",this._target)},closeButton:function(b){b.preventDefault(),a(document.body).trigger("ac_backbone_modal_before_remove",this._target),this.undelegateEvents(),a(document).off("focusin"),a(document.body).css({overflow:"auto"}),this.remove(),a(document.body).trigger("ac_backbone_modal_removed",this._target)},addButton:function(b){a(document.body).trigger("ac_backbone_modal_response",[this._target,this.getFormData()]),this.closeButton(b)},getFormData:function(){var b={};return a(document.body).trigger("ac_backbone_modal_before_update",this._target),a.each(a("form",this.$el).serializeArray(),function(c,d){b.hasOwnProperty(d.name)?(b[d.name]=a.makeArray(b[d.name]),b[d.name].push(d.value)):b[d.name]=d.value}),b},keyboardActions:function(a){var b=a.keyCode||a.which;13!==b||a.target.tagName&&("input"===a.target.tagName.toLowerCase()||"textarea"===a.target.tagName.toLowerCase())||this.addButton(a),27===b&&this.closeButton(a)}})}(jQuery,Backbone,_);